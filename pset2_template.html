<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Regina Hou">
<meta name="dcterms.date" content="2024-10-19">

<title>30538 Problem Set 2: Parking Tickets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pset2_template_files/libs/clipboard/clipboard.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/quarto.js"></script>
<script src="pset2_template_files/libs/quarto-html/popper.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pset2_template_files/libs/quarto-html/anchor.min.js"></script>
<link href="pset2_template_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pset2_template_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pset2_template_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pset2_template_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pset2_template_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">30538 Problem Set 2: Parking Tickets</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Regina Hou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<ol type="1">
<li>“This submission is my work alone and complies with the 30538 integrity policy.” Add your initials to indicate your agreement: ***</li>
<li>“I have uploaded the names of anyone I worked with on the problem set <strong><a href="https://docs.google.com/forms/d/1-zzHx762odGlpVWtgdIC55vqF-j3gqdAp6Pno1rIGK0/edit">here</a></strong>” **__** (1 point)</li>
<li>Late coins used this pset: **__<em>* Late coins left after submission: **__</em>*</li>
<li>Knit your <code>ps2.qmd</code> to make <code>ps2.pdf</code>.
<ul>
<li>The PDF should not be more than 25 pages. Use <code>head()</code> and re-size figures when appropriate.</li>
</ul></li>
<li>Push <code>ps2.qmd</code> and <code>ps2.pdf</code> to your github repo. It is fine to use Github Desktop.</li>
<li>Submit <code>ps2.pdf</code> via Gradescope (4 points)</li>
<li>Tag your submission in Gradescope</li>
</ol>
<div id="70dc82bf" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>alt.renderers.enable(<span class="st">"png"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-cleaning-continued-15-points" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-continued-15-points">Data cleaning continued (15 points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="da64e28e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'/Users/hkkkkk/Documents/GitHub/Python2/problem_sets/ps1/data/parking_tickets_one_percent.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_na(df):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Variable'</span>: df.columns,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'NA_Count'</span>: df.isna().<span class="bu">sum</span>().values</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>na_summary <span class="op">=</span> count_na(df)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(na_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Variable  NA_Count
0              Unnamed: 0         0
1           ticket_number         0
2              issue_date         0
3      violation_location         0
4    license_plate_number         0
5     license_plate_state        97
6      license_plate_type      2054
7                 zipcode     54115
8          violation_code         0
9   violation_description         0
10                   unit        29
11       unit_description         0
12           vehicle_make         0
13     fine_level1_amount         0
14     fine_level2_amount         0
15     current_amount_due         0
16         total_payments         0
17           ticket_queue         0
18      ticket_queue_date         0
19           notice_level     84068
20    hearing_disposition    259899
21          notice_number         0
22                officer         0
23                address         0</code></pre>
</div>
</div>
<ol start="2" type="1">
<li><p>zipcode, notice_level, and hearing_disposition have higher frenquency of missing. Based on the reading, there are a lot of tickets issued outside their residential areas, so it is hard to get the accurate zipcode; The notice level refer to stages of notifications sent to the vehicle owner. Not all tickets may have reached a notice stage, especially if they are recent or resolved promptly before a notice needed to be sent; This also lead to the missing values in the hearing_discription.The majority of tickets may not lead to a hearing if they are paid promptly or not disputed.</p></li>
<li><p>The old violation code is: 0964125 The cost of an initial offense used to be around $120 for a vehicle missing a city sticker. The new violation code is: 0976170 OR 0964125B After the changes, the fine increased to $200 for a vehicle missing a city sticker.</p></li>
<li><p>The initial offense under the old violation code is $120; the initial offense under the new violation code is $200</p></li>
</ol>
</section>
<section id="revenue-increase-from-missing-city-sticker-tickets-35-points" class="level2">
<h2 class="anchored" data-anchor-id="revenue-increase-from-missing-city-sticker-tickets-35-points">Revenue increase from “missing city sticker” tickets (35 Points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="a1d20d37" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'combined_code'</span>] <span class="op">=</span> df[<span class="st">'violation_code'</span>].replace({</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'0964125'</span>: <span class="st">'CitySticker'</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'0964125B'</span>: <span class="st">'CitySticker'</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'issue_date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'issue_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets <span class="op">=</span> df[df[<span class="st">'combined_code'</span>] <span class="op">==</span> <span class="st">'CitySticker'</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets_by_month <span class="op">=</span> city_sticker_tickets.groupby(city_sticker_tickets[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)).size().reset_index(name<span class="op">=</span><span class="st">'ticket_count'</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets_by_month[<span class="st">'issue_date'</span>] <span class="op">=</span> city_sticker_tickets_by_month[<span class="st">'issue_date'</span>].dt.to_timestamp()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(city_sticker_tickets_by_month).mark_line().encode(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'issue_date:T'</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'ticket_count:Q'</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'issue_date:T'</span>, <span class="st">'ticket_count:Q'</span>]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Missing City Sticker Tickets Over Time'</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-4-output-1.png" width="353" height="364" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li></li>
</ol>
<div id="49b17a8c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>city_sticker_by_month <span class="op">=</span> city_sticker_tickets.groupby(city_sticker_tickets[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)).size().reset_index(name<span class="op">=</span><span class="st">'ticket_count'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>city_sticker_by_month[<span class="st">'issue_date'</span>] <span class="op">=</span> city_sticker_by_month[<span class="st">'issue_date'</span>].dt.to_timestamp()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(city_sticker_by_month).mark_line().encode(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'issue_date:T'</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            axis<span class="op">=</span>alt.Axis(<span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>,  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                          labelAngle<span class="op">=-</span><span class="dv">45</span>,  </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                          tickCount<span class="op">=</span><span class="st">'month'</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                          title<span class="op">=</span><span class="st">'Month of Issue'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>           ),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'ticket_count:Q'</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'issue_date'</span>, <span class="st">'ticket_count'</span>]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Missing City Sticker Tickets Over Time'</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-5-output-1.png" width="353" height="388" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>I used Altair’s TimeUnit Transform Documentation: https://altair-viz.github.io/user_guide/transform/timeunit.html; and Altair’s Axis Labels Documentation: https://altair-viz.github.io/user_guide/customization.html#axis-labels.</p>
<ol start="3" type="1">
<li></li>
</ol>
<div id="2e9acfb0" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets_prior <span class="op">=</span> city_sticker_tickets[(city_sticker_tickets[<span class="st">'issue_date'</span>] <span class="op">&gt;=</span> <span class="st">'2012-02-25'</span>) <span class="op">&amp;</span>                                (city_sticker_tickets[<span class="st">'issue_date'</span>] <span class="op">&lt;</span> <span class="st">'2013-01-01'</span>)]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>num_tickets_prior <span class="op">=</span> <span class="bu">len</span>(city_sticker_tickets_prior)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>old_price <span class="op">=</span> <span class="dv">120</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>new_price <span class="op">=</span> <span class="dv">200</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>revenue_before <span class="op">=</span> num_tickets_prior <span class="op">*</span> old_price</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>revenue_after <span class="op">=</span> num_tickets_prior <span class="op">*</span> new_price</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>revenue_increase <span class="op">=</span> (revenue_after <span class="op">-</span> revenue_before) <span class="op">*</span> <span class="dv">100</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Projected revenue increase: $</span><span class="sc">{</span>revenue_increase<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Projected revenue increase: $15816000.00</code></pre>
</div>
</div>
<p>Projected revenue increase: $15816000.00</p>
<ol start="4" type="1">
<li></li>
</ol>
<div id="b513c969" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tickets_2012 <span class="op">=</span> city_sticker_tickets[(city_sticker_tickets[<span class="st">'issue_date'</span>] <span class="op">&gt;=</span> <span class="st">'2012-02-25'</span>) <span class="op">&amp;</span> (city_sticker_tickets[<span class="st">'issue_date'</span>] <span class="op">&lt;</span> <span class="st">'2013-01-01'</span>)]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tickets_2013 <span class="op">=</span> city_sticker_tickets[city_sticker_tickets[<span class="st">'issue_date'</span>].dt.year <span class="op">==</span> <span class="dv">2013</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>tickets_2012[<span class="st">'paid'</span>] <span class="op">=</span> tickets_2012[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>num_tickets_2012 <span class="op">=</span> <span class="bu">len</span>(tickets_2012)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>num_paid_2012 <span class="op">=</span> tickets_2012[<span class="st">'paid'</span>].<span class="bu">sum</span>()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>repayment_rate_2012 <span class="op">=</span> num_paid_2012 <span class="op">/</span> num_tickets_2012</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>tickets_2013[<span class="st">'paid'</span>] <span class="op">=</span> tickets_2013[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>num_tickets_2013 <span class="op">=</span> <span class="bu">len</span>(tickets_2013)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>num_paid_2013 <span class="op">=</span> tickets_2013[<span class="st">'paid'</span>].<span class="bu">sum</span>()</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>repayment_rate_2013 <span class="op">=</span> num_paid_2013 <span class="op">/</span> num_tickets_2013</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate in 2012 (Feb 25 onwards): </span><span class="sc">{</span>repayment_rate_2012<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Repayment Rate in 2013: </span><span class="sc">{</span>repayment_rate_2013<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>old_price <span class="op">=</span> <span class="dv">120</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>new_price <span class="op">=</span> <span class="dv">200</span>  </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>revenue_before <span class="op">=</span> num_tickets_2012 <span class="op">*</span> repayment_rate_2012 <span class="op">*</span> old_price</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>revenue_after <span class="op">=</span> num_tickets_2012 <span class="op">*</span> repayment_rate_2013 <span class="op">*</span> new_price  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>revenue_change <span class="op">=</span> (revenue_after <span class="op">-</span> revenue_before) <span class="op">*</span> <span class="dv">100</span>  </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Projected Change in Revenue: $</span><span class="sc">{</span>revenue_change<span class="sc">:,.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Repayment Rate in 2012 (Feb 25 onwards): 51.80%
Repayment Rate in 2013: 43.79%
Projected Change in Revenue: $5,025,190.49</code></pre>
</div>
</div>
<ol start="5" type="1">
<li></li>
</ol>
<div id="f4ff3525" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets[<span class="st">'month'</span>] <span class="op">=</span> city_sticker_tickets[<span class="st">'issue_date'</span>].dt.to_period(<span class="st">'M'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>city_sticker_tickets[<span class="st">'paid'</span>] <span class="op">=</span> city_sticker_tickets[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>monthly_repayment <span class="op">=</span> city_sticker_tickets.groupby(<span class="st">'month'</span>).agg(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'combined_code'</span>, <span class="st">'size'</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    tickets_paid<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'sum'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>monthly_repayment[<span class="st">'repayment_rate'</span>] <span class="op">=</span> monthly_repayment[<span class="st">'tickets_paid'</span>] <span class="op">/</span> monthly_repayment[<span class="st">'total_tickets'</span>]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>monthly_repayment[<span class="st">'month'</span>] <span class="op">=</span> monthly_repayment[<span class="st">'month'</span>].dt.to_timestamp()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>repayment_rate_chart <span class="op">=</span> alt.Chart(monthly_repayment).mark_line().encode(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'month:T'</span>, title<span class="op">=</span><span class="st">'Month'</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'month'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Repayment Rates for Missing City Sticker Tickets'</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>policy_change_date <span class="op">=</span> pd.to_datetime(<span class="st">'2012-02-25'</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>policy_change_line <span class="op">=</span> alt.Chart(pd.DataFrame({<span class="st">'policy_change'</span>: [policy_change_date]})).mark_rule(color<span class="op">=</span><span class="st">'red'</span>).encode(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'policy_change:T'</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>final_chart <span class="op">=</span> repayment_rate_chart <span class="op">+</span> policy_change_line</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>final_chart.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-8-output-1.png" width="349" height="364" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Before the policy changed, the repayment rate fluctuates significantly but generally remains between 0.5 and 0.6. However, after the Feb 2012 when the policy changed, the the repayment rate begins to decline steadily over the next several years, and there is a significant drop of the repayment rate by 2018.</p>
<ol start="6" type="1">
<li></li>
</ol>
<div id="e64785b2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'paid'</span>] <span class="op">=</span> df[<span class="st">'total_payments'</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>violation_stats <span class="op">=</span> df.groupby([<span class="st">'violation_code'</span>, <span class="st">'violation_description'</span>]).agg(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'violation_code'</span>, <span class="st">'size'</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    tickets_paid<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'sum'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>violation_stats[<span class="st">'repayment_rate'</span>] <span class="op">=</span> violation_stats[<span class="st">'tickets_paid'</span>] <span class="op">/</span> violation_stats[<span class="st">'total_tickets'</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>top_violations <span class="op">=</span> violation_stats.sort_values(by<span class="op">=</span>[<span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>], ascending<span class="op">=</span>[<span class="va">False</span>, <span class="va">False</span>]).head(<span class="dv">3</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>violation_chart <span class="op">=</span> alt.Chart(violation_stats).mark_circle(size<span class="op">=</span><span class="dv">60</span>).encode(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'total_tickets:Q'</span>, title<span class="op">=</span><span class="st">'Total Tickets Issued'</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.condition(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        alt.FieldOneOfPredicate(field<span class="op">=</span><span class="st">'violation_code'</span>, oneOf<span class="op">=</span>top_violations[<span class="st">'violation_code'</span>].tolist()),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        alt.value(<span class="st">'red'</span>),  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        alt.value(<span class="st">'blue'</span>)  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_code'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Violation Types: Total Tickets Issued vs. Repayment Rate'</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>violation_chart.show()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 3 Violation Types to Increase Prices:"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_violations[[<span class="st">'violation_code'</span>, <span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_violations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-9-output-1.png" width="373" height="364" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 3 Violation Types to Increase Prices:
    violation_code                     violation_description  total_tickets  \
101       0976160F  EXPIRED PLATES OR TEMPORARY REGISTRATION          44811   
9         0964040B                           STREET CLEANING          28712   
23        0964090E                RESIDENTIAL PERMIT PARKING          23683   

     repayment_rate  
101        0.608065  
9          0.815896  
23         0.745978  
    violation_code                     violation_description  total_tickets  \
101       0976160F  EXPIRED PLATES OR TEMPORARY REGISTRATION          44811   
9         0964040B                           STREET CLEANING          28712   
23        0964090E                RESIDENTIAL PERMIT PARKING          23683   

     tickets_paid  repayment_rate  
101         27248        0.608065  
9           23426        0.815896  
23          17667        0.745978  </code></pre>
</div>
</div>
<p>Because those three violation types have high number of total ticket issued, and have relatively high repayment rate. Therefore, those three types are more likely to get more revenue by increasing the prices.</p>
</section>
<section id="headlines-and-sub-messages-20-points" class="level2">
<h2 class="anchored" data-anchor-id="headlines-and-sub-messages-20-points">Headlines and sub-messages (20 points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="2d8c30cc" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>violation_summary <span class="op">=</span> df.groupby(<span class="st">'violation_description'</span>).agg(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    total_tickets<span class="op">=</span>(<span class="st">'violation_description'</span>, <span class="st">'size'</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    tickets_paid<span class="op">=</span>(<span class="st">'paid'</span>, <span class="st">'sum'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>violation_summary[<span class="st">'repayment_rate'</span>] <span class="op">=</span> violation_summary[<span class="st">'tickets_paid'</span>] <span class="op">/</span> violation_summary[<span class="st">'total_tickets'</span>]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>violation_summary_sorted <span class="op">=</span> violation_summary.sort_values(by<span class="op">=</span><span class="st">'total_tickets'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>top_5_violations <span class="op">=</span> violation_summary_sorted.head(<span class="dv">5</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Top 5 Most Common Violation Descriptions:"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_5_violations[[<span class="st">'violation_description'</span>, <span class="st">'repayment_rate'</span>, <span class="st">'total_tickets'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 Most Common Violation Descriptions:
                        violation_description  repayment_rate  total_tickets
23   EXPIRED PLATES OR TEMPORARY REGISTRATION        0.608065          44811
101                           STREET CLEANING        0.815896          28712
90                 RESIDENTIAL PERMIT PARKING        0.745978          23683
19   EXP. METER NON-CENTRAL BUSINESS DISTRICT        0.795485          20600
81        PARKING/STANDING PROHIBITED ANYTIME        0.710677          19753</code></pre>
</div>
</div>
<ol start="2" type="1">
<li></li>
</ol>
<div id="1a09b137" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>violation_summary[<span class="st">'repayment_rate'</span>] <span class="op">=</span> violation_summary[<span class="st">'tickets_paid'</span>] <span class="op">/</span> violation_summary[<span class="st">'total_tickets'</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>violation_summary_filtered <span class="op">=</span> violation_summary[violation_summary[<span class="st">'total_tickets'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#scatter plot </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>scatter_plot <span class="op">=</span> alt.Chart(violation_summary_filtered).mark_circle(size<span class="op">=</span><span class="dv">60</span>).encode(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'total_tickets:Q'</span>, title<span class="op">=</span><span class="st">'Total Tickets Issued'</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Relationship Between Total Tickets Issued and Repayment Rate'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>scatter_plot.show()</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#bar plot </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>bar_plot <span class="op">=</span> alt.Chart(violation_summary_filtered).mark_bar().encode(</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'violation_description:N'</span>, sort<span class="op">=</span><span class="st">'-y'</span>, title<span class="op">=</span><span class="st">'Violation Description'</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Bar Plot of Repayment Rate by Violation Description'</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>bar_plot.show()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#heatmap </span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>heatmap <span class="op">=</span> alt.Chart(violation_summary_filtered).mark_rect().encode(</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'total_tickets:Q'</span>, title<span class="op">=</span><span class="st">'Total Tickets Issued'</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'repayment_rate:Q'</span>, title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.Color(<span class="st">'repayment_rate:Q'</span>, scale<span class="op">=</span>alt.Scale(scheme<span class="op">=</span><span class="st">'blues'</span>), title<span class="op">=</span><span class="st">'Repayment Rate'</span>),</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">'violation_description'</span>, <span class="st">'total_tickets'</span>, <span class="st">'repayment_rate'</span>]</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Heatmap of Total Tickets vs Repayment Rate'</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>heatmap.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-11-output-1.png" width="404" height="364" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-11-output-2.png" width="1366" height="534" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pset2_template_files/figure-html/cell-11-output-3.png" width="451" height="364" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>If the City Clerk only look at one plot, I would bring the scatter polt to them because it is the simplest and most clearly shown the level of total tickets issued and the repayment rate. Also, it shows the correlation between the two variables without any further explaination or any scales.</li>
</ol>
</section>
<section id="understanding-the-structure-of-the-data-and-summarizing-it-lecture-5-20-points" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-structure-of-the-data-and-summarizing-it-lecture-5-20-points">Understanding the structure of the data and summarizing it (Lecture 5, 20 Points)</h2>
<ol type="1">
<li></li>
</ol>
<div id="e1377d85" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'fine_ratio'</span>] <span class="op">=</span> df[<span class="st">'fine_level2_amount'</span>] <span class="op">/</span> df[<span class="st">'current_amount_due'</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>common_violations <span class="op">=</span> df.groupby(<span class="st">'violation_code'</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(x) <span class="op">&gt;=</span> <span class="dv">100</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Find violations where the fine does not double (i.e., fine_ratio != 2)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>violations_no_double <span class="op">=</span> common_violations[common_violations[<span class="st">'fine_ratio'</span>] <span class="op">!=</span> <span class="dv">2</span>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Group by violation code and calculate the average increase</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>violation_fine_increase <span class="op">=</span> violations_no_double.groupby(<span class="st">'violation_code'</span>).agg(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    total_citations<span class="op">=</span>(<span class="st">'violation_code'</span>, <span class="st">'size'</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    avg_initial_fine<span class="op">=</span>(<span class="st">'current_amount_due'</span>, <span class="st">'mean'</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    avg_unpaid_fine<span class="op">=</span>(<span class="st">'fine_level2_amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    avg_increase<span class="op">=</span>(<span class="st">'fine_ratio'</span>, <span class="st">'mean'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the violations where fines do not double and the average increase</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Violations where fines do not double and their average increase:"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(violation_fine_increase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Violations where fines do not double and their average increase:
   violation_code  total_citations  avg_initial_fine  avg_unpaid_fine  \
0         0912060             1102         46.325136       180.000000   
1         0940060              212         44.285377       277.594340   
2        0964020A             1023          5.343011        50.000000   
3        0964020B             1339         23.580314       150.000000   
4        0964030B              106         18.547170        90.566038   
..            ...              ...               ...              ...   
57       0980110A              741         61.947881       144.736842   
58       0980110B              306         78.122941       142.320261   
59       0980120A              101         53.834653        97.029703   
60       0980120B              327         14.449541        50.000000   
61       0980130B              210         16.842381        93.809524   

    avg_increase  
0            inf  
1            inf  
2            inf  
3            inf  
4            inf  
..           ...  
57           inf  
58           inf  
59           inf  
60           inf  
61           inf  

[62 rows x 5 columns]</code></pre>
</div>
</div>
<p>No, some violation types increase but not double. 2.</p>
</section>
<section id="extra-credit-max-5-points" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit-max-5-points">Extra Credit (max 5 points)</h2>
<ol type="1">
<li></li>
<li></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>